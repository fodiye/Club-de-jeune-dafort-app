services:
  strapi:
    build:
      context: ./backend
      dockerfile: Dockerfile
    restart: unless-stopped
    environment:
      HOST: 0.0.0.0
      PORT: 1337
      NODE_ENV: production
      APP_KEYS: ${APP_KEYS}
      API_TOKEN_SALT: ${API_TOKEN_SALT}
      ADMIN_JWT_SECRET: ${ADMIN_JWT_SECRET}
      TRANSFER_TOKEN_SALT: ${TRANSFER_TOKEN_SALT}
      JWT_SECRET: ${JWT_SECRET}
      ENCRYPTION_KEY: ${ENCRYPTION_KEY}
      DATABASE_CLIENT: sqlite
      # SMTP (optional)
      SMTP_HOST: ${SMTP_HOST:-}
      SMTP_PORT: ${SMTP_PORT:-587}
      SMTP_LOGIN: ${SMTP_LOGIN:-}
      SMTP_KEY: ${SMTP_KEY:-}
      MAIL_FROM_NAME: ${MAIL_FROM_NAME:-Jeunes en Action}
      MAIL_FROM_EMAIL: ${MAIL_FROM_EMAIL:-}
      MAIL_TO_EMAIL: ${MAIL_TO_EMAIL:-}
    volumes:
      - strapi-data:/app/.tmp
      - strapi-uploads:/app/public/uploads
    networks:
      - app-network

  frontend:
    build:
      context: .
      dockerfile: Dockerfile
    restart: unless-stopped
    ports:
      - "${PORT:-80}:80"
    depends_on:
      - strapi
    networks:
      - app-network

volumes:
  strapi-data:
  strapi-uploads:

networks:
  app-network:
    driver: bridge
